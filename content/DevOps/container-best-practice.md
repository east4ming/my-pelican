Title: å®¹å™¨æœ€ä½³å®è·µ
Status: published
Tags: python, java, openshift, docker, æœ€ä½³å®è·µ, k8s, containers
Date: 2019-07-25 17:00
Modified: 
Author: ä¸œé£å¾®é¸£
Slug: container-best-practices
Summary: è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ç¿»è¯‘è‡ªOpenShiftå…³äºé•œåƒçš„æœ€ä½³å®è·µ, åŒæ—¶ç»“åˆæˆ‘çœ‹åˆ°çš„å…¶ä»–å…³äºé•œåƒæœ€ä½³å®è·µçš„æ–‡ç« , ä»¥åŠæˆ‘æ—¥å¸¸å·¥ä½œä¸­çš„ä½“ä¼šæ€»ç»“å‡ºæ¥çš„. åŒ…æ‹¬é€šç”¨çš„å®¹å™¨æœ€ä½³å®è·µ, java, nginx, pythonå®¹å™¨æœ€ä½³å®è·µä»¥åŠOpenShiftä¸Šå®¹å™¨æœ€ä½³å®è·µ. æœ€ä½³å®è·µçš„ç›®çš„ä¸€æ–¹é¢æ˜¯ä¸ºäº†æå‡DevOpsæ•ˆç‡, å¦ä¸€æ–¹é¢æ˜¯ä¸ºäº†æé«˜å®‰å…¨æ€§. å¸Œæœ›å¯¹å„ä½æœ‰æ‰€å¸®åŠ©.
Image: /images/illustration-com-container-party.png

[TOC]

## æ¦‚è¿°

å­¦ä¹ åˆ¶ä½œé•œåƒçš„æœ€ä½³å®è·µã€‚

è¿™ç¯‡æ–‡ç« ä¸»è¦æ˜¯ç¿»è¯‘è‡ªOpenShiftå…³äºé•œåƒçš„æœ€ä½³å®è·µ, åŒæ—¶ç»“åˆæˆ‘çœ‹åˆ°çš„å…¶ä»–å…³äºé•œåƒæœ€ä½³å®è·µçš„æ–‡ç« , ä»¥åŠæˆ‘æ—¥å¸¸å·¥ä½œä¸­çš„ä½“ä¼šæ€»ç»“å‡ºæ¥çš„. åŒ…æ‹¬é€šç”¨çš„å®¹å™¨æœ€ä½³å®è·µ, java, nginx, pythonå®¹å™¨æœ€ä½³å®è·µä»¥åŠOpenShiftä¸Šå®¹å™¨æœ€ä½³å®è·µ. æœ€ä½³å®è·µçš„ç›®çš„ä¸€æ–¹é¢æ˜¯ä¸ºäº†æå‡DevOpsæ•ˆç‡, å¦ä¸€æ–¹é¢æ˜¯ä¸ºäº†æé«˜å®‰å…¨æ€§. å¸Œæœ›å¯¹å„ä½æœ‰æ‰€å¸®åŠ©.

åœ¨åˆ›å»ºè¦åœ¨Docker, Kubernetes, æˆ–è€…Openshiftå®¹å™¨å¹³å°ä¸Šè¿è¡Œçš„å®¹å™¨é•œåƒæ—¶ï¼Œä½œä¸ºä¸€åé•œåƒä½œè€…å’Œç»´æŠ¤è€…ï¼Œéœ€è¦è€ƒè™‘è®¸å¤šæœ€ä½³å®è·µï¼Œä»¥ç¡®ä¿ä¸ºè¿™äº›é•œåƒçš„ä½¿ç”¨è€…æä¾›è‰¯å¥½çš„ä½“éªŒã€‚å› ä¸ºé•œåƒæ˜¯ä¸å¯å˜çš„å¹¶æŒ‰åŸæ ·ä½¿ç”¨ï¼Œä¸‹é¢çš„æŒ‡å¯¼åŸåˆ™æœ‰åŠ©äºç¡®ä¿æ‚¨çš„é•œåƒæ˜¯é«˜åº¦å¯å¤ç”¨çš„ï¼Œå¹¶ä¸”æ˜“äºåœ¨Docker, Kubernetes æˆ– Openshiftå®¹å™¨å¹³å°ä¸Šä½¿ç”¨ã€‚

### ç¿»è¯‘å¯¹ç…§è¡¨

| è‹±æ–‡                         | ä¸­æ–‡              | è¯´æ˜                                                        |
| ---------------------------- | ----------------- | ----------------------------------------------------------- |
| tag                          | æ ‡ç­¾              | dockeré•œåƒç‰ˆæœ¬æ ‡ç­¾                                          |
| image                        | é•œåƒ              |                                                             |
| container                    | å®¹å™¨              |                                                             |
| pod                          |                   | Kubernetesçš„æœ€å°æ‰˜ç®¡å•ä½, ä¸€èˆ¬ä¸ºä¸€ä¸ªå®¹å™¨, ä¹Ÿå¯ä»¥ä¸ºå¤šä¸ªå®¹å™¨. |
| namespace                    | å‘½åç©ºé—´          |                                                             |
| image layer                  | é•œåƒå±‚            |                                                             |
| metadata                     | å…ƒæ•°æ®            |                                                             |
| node                         | èŠ‚ç‚¹              | Kubernetes æ¦‚å¿µ, æŒ‡ä¸»æœº.                                    |
| OpenShift Container Platform | OpenShiftå®¹å™¨å¹³å° |                                                             |
| SOURCE-TO-IMAGE              | æºåˆ°é•œåƒ          | OpenShiftå®¹å™¨å¹³å°çš„ä¸“æœ‰CI/CDæ–¹å¼                            |
| root group                   | æ ¹ç»„              | *NIXçš„æ¦‚å¿µ                                                  |
| service account              | æœåŠ¡å¸æˆ·          | Kubernetesæˆ– OpenShiftçš„æ¦‚å¿µ                                |
| security context constraint  | å®‰å…¨ä¸Šä¸‹æ–‡çº¦æŸ    | OpenShiftå®¹å™¨å¹³å°çš„æ¦‚å¿µ                                     |
| service                      | æœåŠ¡              | Kubernetes æ¦‚å¿µ                                             |
| image registry               | é•œåƒæ³¨å†Œè¡¨        |                                                             |
| heap                         | å †                | ä¸€ç§JVMå†…å­˜ç±»å‹                                             |
| out-of-memory                | å†…å­˜ä¸è¶³          | JVMæŠ¥é”™                                                     |
| liveness probe               | æ´»æ€§æ¢é’ˆ          | Kubernetes æ¦‚å¿µ - ç”¨äºæ£€æŸ¥å®¹å™¨çŠ¶æ€                          |
| readiness probe              | å°±ç»ªæ¢é’ˆ          | Kubernetes æ¦‚å¿µ - ç”¨äºæ£€æŸ¥å®¹å™¨çŠ¶æ€                          |
| template                     | æ¨¡æ¿              |                                                             |
| label                        | æ ‡ç­¾              | dockerfileæ¦‚å¿µ                                              |
| quota                        | é…é¢              |                                                             |



## é€šç”¨å®¹å™¨é•œåƒæŒ‡å—

é€šå¸¸ï¼Œåœ¨åˆ›å»ºå®¹å™¨é•œåƒæ—¶ï¼Œä»¥ä¸‹å‡†åˆ™æ™®éé€‚ç”¨ï¼Œå¹¶ä¸”ä¸æ˜¯å¦åœ¨OpenShift Container Platformä¸Šä½¿ç”¨é•œåƒæ— å…³ã€‚

### ä½¿ç”¨ `LABEL maintainer`

`LABEL maintainer`æŒ‡ä»¤è®¾ç½®é•œåƒçš„authorå­—æ®µã€‚å¦‚æœæ‚¨çš„ç”¨æˆ·æœ‰é—®é¢˜ï¼Œè¿™å¯¹äºå‘ä»–ä»¬æä¾›ç”µå­é‚®ä»¶è”ç³»éå¸¸æœ‰ç”¨ã€‚

### å¤ç”¨é•œåƒ

åªè¦æœ‰å¯èƒ½ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨`FROM`è¯­å¥å°†é•œåƒåŸºäºé€‚å½“çš„ä¸Šæ¸¸é•œåƒã€‚è¿™å¯ç¡®ä¿æ‚¨çš„é•œåƒåœ¨æ›´æ–°æ—¶å¯ä»¥è½»æ¾ä»ä¸Šæ¸¸æ˜ åƒä¸­è·å–å®‰å…¨ä¿®å¤ç¨‹åºï¼Œè€Œä¸å¿…ç›´æ¥æ›´æ–°ä¾èµ–é¡¹ã€‚

æ­¤å¤–ï¼Œåœ¨`FROM`æŒ‡ä»¤ä¸­ä½¿ç”¨æ ‡ç­¾ tagï¼ˆä¾‹å¦‚ `rhel:rhel7`ï¼‰ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ¸…æ¥šåœ°äº†è§£é•œåƒæ‰€åŸºäºçš„ä¸Šæ¸¸é•œåƒç‰ˆæœ¬ã€‚

:exclamation: **ç¦æ­¢**ä½¿ç”¨`latest` tagä»¥ç¡®ä¿æ‚¨çš„é•œåƒä¸ä¼šå—åˆ°`latest`ä¸Šæ¸¸é•œåƒç‰ˆæœ¬çš„é‡å¤§æ›´æ”¹çš„å½±å“ã€‚

### ä¿æŒæ ‡ç­¾ TAGS çš„å…¼å®¹æ€§

ç»™è‡ªå·±çš„é•œåƒæ‰“æ ‡ç­¾æ—¶ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨å°è¯•åœ¨æ ‡ç­¾å†…ä¿æŒå‘åå…¼å®¹æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æä¾›ä¸€ä¸ªåä¸º`foo`çš„é•œåƒï¼Œå¹¶ä¸”å®ƒå½“å‰ä¸º1.0ç‰ˆï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥æä¾›ä¸€ä¸ª`foo:v1`æ ‡ç­¾ã€‚å½“æ‚¨æ›´æ–°é•œåƒæ—¶ï¼Œåªè¦å®ƒç»§ç»­ä¸åŸå§‹é•œåƒå…¼å®¹ï¼Œå°±å¯ä»¥ç»§ç»­æ ‡è®°æ–°å›¾åƒä¸º`foo:v1`ï¼Œå¹¶ä¸”è¯¥æ ‡è®°çš„ä¸‹æ¸¸æ¶ˆè´¹è€…å°†èƒ½å¤Ÿåœ¨ä¸ä¸­æ–­çš„æƒ…å†µä¸‹è·å¾—æ›´æ–°ã€‚

å¦‚æœæ‚¨ç¨åå‘å¸ƒäº†ä¸å…¼å®¹çš„æ›´æ–°ï¼Œé‚£ä¹ˆæ‚¨åº”è¯¥åˆ‡æ¢åˆ°ä¸€ä¸ªæ–°æ ‡ç­¾ï¼Œä¾‹å¦‚`foo:v2`ã€‚è¿™å…è®¸ä¸‹æ¸¸æ¶ˆè´¹è€…å¯ä»¥æŒ‰ç…§è‡ªèº«æ„æ„¿å‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼Œä½†ä¸ä¼šè¢«æ–°çš„ä¸å…¼å®¹é•œåƒæ— æ„ä¸­ç ´åã€‚ä½†æ˜¯ä»»ä½•ä½¿ç”¨`foo:latest`çš„ä¸‹æ¸¸æ¶ˆè´¹è€…éƒ½ä¼šæ‰¿æ‹…å¼•å…¥ä¸å…¼å®¹æ›´æ”¹çš„é£é™©ã€‚

### é¿å…å¤šä¸ªè¿›ç¨‹

æˆ‘ä»¬å»ºè®®æ‚¨**ä¸è¦**åœ¨ä¸€ä¸ªå®¹å™¨å†…å¯åŠ¨å¤šä¸ªæœåŠ¡ï¼Œä¾‹å¦‚æ•°æ®åº“å’Œsshdã€‚è¿™æ˜¯ä¸å¿…è¦çš„ï¼Œå› ä¸ºå®¹å™¨æ˜¯è½»é‡çº§çš„ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°é“¾æ¥åœ¨ä¸€èµ·ä»¥åè°ƒå¤šä¸ªè¿›ç¨‹ã€‚Kuberneteså’ŒOpenshiftå®¹å™¨å¹³å°å…è®¸æ‚¨é€šè¿‡å°†ç›¸å…³é•œåƒåˆ†ç»„åˆ°å•ä¸ªpodä¸­ï¼Œè½»æ¾åœ°å¯¹å®ƒä»¬è¿›è¡Œé›†ä¸­å’Œå…±åŒç®¡ç†ã€‚

è¿™ä¸ªæ‰˜ç®¡å•ä½(æŒ‡pod)ç¡®ä¿å•ä½å†…çš„å®¹å™¨é—´å…±äº«ç½‘ç»œåç§°ç©ºé—´å’Œé€šä¿¡å­˜å‚¨ã€‚æ›´æ–°çš„å¹²æ‰°ä¹Ÿè¾ƒå°ã€‚å•è¿›ç¨‹çš„ä¿¡å·å¤„ç†æµç¨‹ä¹Ÿæ›´æ¸…æ™°ï¼Œå› ä¸ºæ‚¨ä¸å¿…ç®¡ç†è·¯ç”±ä¿¡å·åˆ°ç”Ÿæˆçš„è¿›ç¨‹ã€‚

### åœ¨å°è£…è„šæœ¬ä¸­ä½¿ç”¨ `EXEC` æŒ‡ä»¤

è®¸å¤šé•œåƒåœ¨ä¸ºæ­£åœ¨è¿è¡Œçš„è½¯ä»¶å¯åŠ¨è¿›ç¨‹ä¹‹å‰ä½¿ç”¨å°è£…è„šæœ¬è¿›è¡Œä¸€äº›è®¾ç½®ã€‚å¦‚æœæ‚¨çš„é•œåƒä½¿ç”¨è¿™æ ·çš„è„šæœ¬ï¼Œé‚£ä¹ˆè¯¥è„šæœ¬åº”è¯¥ä½¿ç”¨`exec`ï¼Œä»¥ä¾¿ç”¨è½¯ä»¶æ›¿æ¢è¯¥è„šæœ¬çš„è¿›ç¨‹ã€‚å¦‚æœä¸ä½¿ç”¨`exec`ï¼Œé‚£ä¹ˆå®¹å™¨è¿è¡Œæ—¶å‘é€çš„ä¿¡å·å°†è½¬åˆ°å°è£…è„šæœ¬ï¼Œè€Œä¸æ˜¯è½¯ä»¶çš„è¿›ç¨‹ã€‚è¿™ä¸æ˜¯ä½ æƒ³è¦çš„ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š

![å‘é€ä¿¡å·é—®é¢˜](./images/bash_signal.png)

å‡è®¾æ‚¨æœ‰ä¸€ä¸ªå°è£…è„šæœ¬æ¥å¯åŠ¨æŸä¸ªæœåŠ¡å™¨çš„è¿›ç¨‹ã€‚å¯åŠ¨å®¹å™¨ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨`docker run -i`ï¼‰ï¼Œå®ƒè¿è¡Œå°è£…è„šæœ¬ï¼Œç„¶åå¯åŠ¨è¿›ç¨‹ã€‚ç°åœ¨å‡è®¾æ‚¨å¸Œæœ›ä½¿ç”¨`ctrl+c`ç»ˆæ­¢å®¹å™¨ã€‚å¦‚æœå°è£…è„šæœ¬ä½¿ç”¨`exec`å¯åŠ¨æœåŠ¡å™¨è¿›ç¨‹ï¼Œdockerå°†å‘æœåŠ¡å™¨è¿›ç¨‹å‘é€*sigint*ï¼Œå¹¶ä¸”ä¸€åˆ‡éƒ½å°†æŒ‰é¢„æœŸå·¥ä½œã€‚å¦‚æœæ‚¨æ²¡æœ‰åœ¨å°è£…è„šæœ¬ä¸­ä½¿ç”¨`exec`ï¼Œdockerä¼šå°†*sigint*å‘é€åˆ°å°è£…è„šæœ¬çš„è¿›ç¨‹ï¼Œå¹¶ä¸”æ‚¨çš„æœåŠ¡å™¨è¿›ç¨‹å°†åƒä»€ä¹ˆéƒ½æ²¡æœ‰å‘ç”Ÿä¸€æ ·ç»§ç»­è¿è¡Œã€‚

è¿˜è¦æ³¨æ„ï¼Œå½“åœ¨å®¹å™¨ä¸­è¿è¡Œæ—¶ï¼Œæ‚¨çš„è¿›ç¨‹ä½œä¸º**pid 1**è¿è¡Œã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœä¸»è¿›ç¨‹ç»ˆæ­¢ï¼Œæ•´ä¸ªå®¹å™¨å°†åœæ­¢ï¼Œä»è€Œæ€æ­»æ‚¨å¯èƒ½ä»**PID 1**è¿›ç¨‹å¯åŠ¨çš„ä»»ä½•å­è¿›ç¨‹ã€‚

æœ‰å…³å…¶ä»–å«ä¹‰ï¼Œè¯·å‚é˜… [â€œDockerå’ŒPID 1 zombieæ”¶è·é—®é¢˜â€](http://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/)åšå®¢æ–‡ç« ã€‚å¦è¯·å‚é˜…[â€œæ­å¼€initç³»ç»Ÿï¼ˆPID 1ï¼‰çš„ç¥ç§˜é¢çº±â€](https://felipec.wordpress.com/2013/11/04/init/)åšå®¢æ–‡ç« ï¼Œæ·±å…¥äº†è§£PID 1å’Œ**init** ç³»ç»Ÿã€‚

### æ¸…é™¤ä¸´æ—¶æ–‡ä»¶

åº”åˆ é™¤åœ¨ç”Ÿæˆè¿‡ç¨‹ä¸­åˆ›å»ºçš„**æ‰€æœ‰ä¸´æ—¶æ–‡ä»¶**ã€‚è¿™è¿˜åŒ…æ‹¬ä½¿ç”¨`ADD`æŒ‡ä»¤æ·»åŠ çš„ä»»ä½•æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼ŒğŸ‘ æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨åœ¨æ‰§è¡Œ`yum install`æ“ä½œä¹‹åè¿è¡Œ`yum clean`å‘½ä»¤ã€‚

é€šè¿‡å¦‚ä¸‹åˆ›å»º`RUN`è¯­å¥ï¼Œå¯ä»¥é˜²æ­¢`yum`ç¼“å­˜å­˜å‚¨åœ¨é•œåƒå±‚ä¸­ï¼š

```dockerfile
RUN yum -y install mypackage && yum -y install myotherpackage && yum clean all -y
```



è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨æ”¹ä¸ºï¼š

```dockerfile
RUN yum -y install mypackage
RUN yum -y install myotherpackage && yum clean all -y
```

é‚£ä¹ˆï¼Œç¬¬ä¸€ä¸ª`yum`è°ƒç”¨ä¼šåœ¨è¯¥å±‚ä¸­ç•™ä¸‹é¢å¤–çš„æ–‡ä»¶ï¼Œå¹¶ä¸”åœ¨ç¨åè¿è¡Œ`yum clean`æ“ä½œæ—¶ï¼Œæ— æ³•åˆ é™¤è¿™äº›æ–‡ä»¶ã€‚é¢å¤–çš„æ–‡ä»¶åœ¨æœ€ç»ˆé•œåƒä¸­ä¸å¯è§ï¼Œä½†å®ƒä»¬å­˜åœ¨äºåº•å±‚ä¸­ã€‚

å½“å‰å®¹å™¨ç”Ÿæˆè¿‡ç¨‹ä¸å…è®¸åœ¨è¾ƒæ–°çš„å±‚ä¸­è¿è¡Œå‘½ä»¤ï¼Œä»¥ç¼©å°åœ¨è¾ƒæ—©çš„å±‚ä¸­åˆ é™¤æŸäº›å†…å®¹æ—¶å›¾åƒæ‰€ä½¿ç”¨çš„ç©ºé—´ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœåœ¨åé¢çš„å±‚ä¸­æ‰§è¡Œrmå‘½ä»¤ï¼Œå°½ç®¡æ–‡ä»¶æ˜¯éšè—çš„ï¼Œä½†å®ƒä¸ä¼šå‡å°‘è¦ä¸‹è½½çš„é•œåƒçš„æ€»ä½“å¤§å°ã€‚å› æ­¤ï¼Œä¸`yum clean`ç¤ºä¾‹ä¸€æ ·ï¼Œæœ€å¥½åœ¨å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨åˆ›å»ºæ–‡ä»¶çš„ç›¸åŒå‘½ä»¤åˆ é™¤æ–‡ä»¶ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šè¢«å†™å…¥æŸä¸ªå±‚ã€‚

æ­¤å¤–ï¼Œåœ¨ä¸€æ¡`RUN`è¯­å¥ä¸­æ‰§è¡Œå¤šä¸ªå‘½ä»¤å¯ä»¥å‡å°‘é•œåƒä¸­çš„å±‚æ•°ï¼Œä»è€Œç¼©çŸ­ä¸‹è½½å’Œæå–æ—¶é—´ã€‚

apt-getä¾‹å­å¦‚ä¸‹: (æœ€åé€šè¿‡`rm -rf /var/lib/apt/lists/*`åˆ é™¤)

```dockerfile
RUN apt-get update && apt-get install -y \
    aufs-tools \
    automake \
    build-essential \
    curl \
    dpkg-sig \
    libcap-dev \
    libsqlite3-dev \
    mercurial \
    reprepro \
    ruby1.9.1 \
    ruby1.9.1-dev \
    s3cmd=1.1.* \
 && rm -rf /var/lib/apt/lists/*
```

> :notebook: å¤‡æ³¨:
>
> 1. `RUN`ã€`COPY`å’Œ`ADD`æ­¥éª¤å°†åˆ›å»ºå±‚ã€‚
> 2. æ¯ä¸ªå±‚åŒ…å«ä¸å‰ä¸€å±‚çš„å·®å¼‚é¡¹ã€‚
> 3. å›¾å±‚ä¼šå¢åŠ æœ€ç»ˆé•œåƒçš„å¤§å°ã€‚

> :notebook: æç¤º:
>
> 1. å°†ç›¸å…³å‘½ä»¤ï¼ˆ`yum install`ï¼‰æ”¾å…¥åŒä¸€`RUN`æ­¥éª¤ã€‚
> 2. åœ¨åŒä¸€`RUN`æ­¥éª¤ä¸­åˆ é™¤åˆ›å»ºçš„æ–‡ä»¶ã€‚
> 3. é¿å…ä½¿ç”¨`apt-get upgrade`æˆ–`yum upgrade all`ï¼Œå› ä¸ºå®ƒå°†æ‰€æœ‰åŒ…å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬.

### æŒ‰æ­£ç¡®çš„é¡ºåºæ”¾ç½®æŒ‡ä»¤

å®¹å™¨æ„å»ºå™¨è¯»å–`dockerfile`å¹¶ä»ä¸Šåˆ°ä¸‹è¿è¡ŒæŒ‡ä»¤ã€‚æˆåŠŸæ‰§è¡Œçš„æ¯ä¸€æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå±‚ï¼Œåœ¨ä¸‹æ¬¡æ„å»ºæ­¤é•œåƒæˆ–å¦ä¸€ä¸ªé•œåƒæ—¶å¯ä»¥é‡ç”¨è¯¥å±‚ã€‚åœ¨Dockerfileçš„é¡¶éƒ¨æ”¾ç½®å¾ˆå°‘æ›´æ”¹çš„æŒ‡ä»¤éå¸¸é‡è¦ã€‚è¿™æ ·åšå¯ä»¥ç¡®ä¿åŒä¸€å›¾åƒçš„ä¸‹ä¸€ä¸ªæ„å»ºé€Ÿåº¦éå¸¸å¿«ï¼Œå› ä¸ºä¸Šå±‚æ›´æ”¹ä¸ä¼šä½¿ç¼“å­˜å¤±æ•ˆã€‚

ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨å¤„ç†ä¸€ä¸ª`dockerfile`ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªç”¨äºå®‰è£…æ­£åœ¨è¿­ä»£çš„æ–‡ä»¶çš„`ADD`æŒ‡ä»¤ï¼Œä»¥åŠä¸€ä¸ªç”¨äº`yum install`åŒ…çš„`RUN`æŒ‡ä»¤ï¼Œé‚£ä¹ˆæœ€å¥½å°†`ADD`å‘½ä»¤æ”¾åœ¨æœ€åï¼š

```dockerfile
FROM foo
RUN yum -y install mypackage && yum clean all -y
ADD myfile /test/myfile
```

è¿™æ ·ï¼Œæ¯æ¬¡ç¼–è¾‘*myfile*å¹¶é‡æ–°è¿è¡Œ``docker build`æ—¶ï¼Œç³»ç»Ÿéƒ½ä¼šä¸º`yum`å‘½ä»¤é‡ç”¨ç¼“å­˜å±‚ï¼Œå¹¶ä¸”åªä¸º`ADD`æ“ä½œç”Ÿæˆæ–°å±‚ã€‚

å¦‚æœç›¸åï¼Œæ‚¨å°†dockerfileç¼–å†™ä¸ºï¼š

```dockerfile
FROM foo
ADD myfile /test/myfile
RUN yum -y install mypackage && yum clean all -y
```

ç„¶åï¼Œæ¯æ¬¡æ›´æ”¹*myfile*å’Œå†æ¬¡è¿è¡Œ`docker build`æ—¶ï¼Œ`ADD`æ“ä½œéƒ½ä¼šä½¿è¿è¡Œå±‚ç¼“å­˜å¤±æ•ˆï¼Œå› æ­¤å¿…é¡»é‡æ–°è¿è¡Œ`yum`æ“ä½œã€‚

### æ ‡è®°é‡è¦ç«¯å£

`EXPOSE`æŒ‡ä»¤ä½¿å®¹å™¨ä¸­çš„ç«¯å£å¯¹ä¸»æœºç³»ç»Ÿå’Œå…¶ä»–å®¹å™¨å¯ç”¨ã€‚è™½ç„¶å¯ä»¥æŒ‡å®šä½¿ç”¨`docker run -p`è°ƒç”¨å…¬å¼€ç«¯å£ï¼Œä½†åœ¨`dockerfile`ä¸­ä½¿ç”¨`EXPOSE`æŒ‡ä»¤å¯ä»¥é€šè¿‡æ˜¾å¼å£°æ˜è½¯ä»¶éœ€è¦è¿è¡Œçš„ç«¯å£ï¼Œä½¿äººå’Œè½¯ä»¶æ›´å®¹æ˜“ä½¿ç”¨æ‚¨çš„é•œåƒï¼š

- æš´éœ²çš„ç«¯å£å°†æ˜¾ç¤ºåœ¨ä¸ä»æ‚¨çš„é•œåƒåˆ›å»ºçš„å®¹å™¨ç›¸å…³è”çš„`docker ps`ä¸‹ã€‚
- `docker inspect`è¿”å›çš„é•œåƒçš„å…ƒæ•°æ®ä¸­ä¹Ÿå°†å­˜åœ¨æš´éœ²çš„ç«¯å£ã€‚
- å½“æ‚¨å°†ä¸€ä¸ªå®¹å™¨é“¾æ¥åˆ°å¦ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œæš´éœ²çš„ç«¯å£å°†è¢«é“¾æ¥ã€‚

### è®¾ç½®ç¯å¢ƒå˜é‡

:+1: ä½¿ç”¨`ENV`æŒ‡ä»¤è®¾ç½®ç¯å¢ƒå˜é‡æ˜¯å¾ˆå¥½çš„å®è·µã€‚ä¸€ä¸ªä¾‹å­æ˜¯è®¾ç½®é¡¹ç›®çš„ç‰ˆæœ¬ã€‚è¿™ä½¿å¾—äººä»¬åœ¨ä¸æŸ¥çœ‹`dockerfile`çš„æƒ…å†µä¸‹å¾ˆå®¹æ˜“æ‰¾åˆ°ç‰ˆæœ¬ã€‚å¦ä¸€ä¸ªä¾‹å­æ˜¯åœ¨ç³»ç»Ÿä¸Šå…¬å¸ƒä¸€æ¡å¯ä»¥è¢«å¦ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨çš„è·¯å¾„ï¼Œæ¯”å¦‚`JAVA_HOME`.

### é¿å…é»˜è®¤å¯†ç 

:exclamation: æœ€å¥½**é¿å…è®¾ç½®é»˜è®¤å¯†ç **ã€‚è®¸å¤šäººä¼šæ‰©å±•é•œåƒï¼Œå¿˜è®°åˆ é™¤æˆ–æ›´æ”¹é»˜è®¤å¯†ç ã€‚å¦‚æœä¸ºç”Ÿäº§ä¸­çš„ç”¨æˆ·åˆ†é…äº†ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„å¯†ç ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚:+1: **åº”è¯¥ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥é…ç½®å¯†ç **ã€‚

å¦‚æœç¡®å®é€‰æ‹©è®¾ç½®é»˜è®¤å¯†ç ï¼Œè¯·ç¡®ä¿åœ¨å®¹å™¨å¯åŠ¨æ—¶æ˜¾ç¤ºé€‚å½“çš„è­¦å‘Šæ¶ˆæ¯ã€‚æ¶ˆæ¯åº”è¯¥é€šçŸ¥ç”¨æˆ·é»˜è®¤å¯†ç çš„å€¼ï¼Œå¹¶è§£é‡Šå¦‚ä½•æ›´æ”¹å®ƒï¼Œä¾‹å¦‚è®¾ç½®ä»€ä¹ˆç¯å¢ƒå˜é‡ã€‚

### ç¦ç”¨SSHD

:exclamation: ç¦æ­¢åœ¨é•œåƒä¸­è¿è¡Œsshdã€‚å¯ä»¥ä½¿ç”¨`docker exec`å‘½ä»¤è®¿é—®æœ¬åœ°ä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨ã€‚æˆ–è€…ï¼Œå¯ä»¥ä½¿ç”¨`oc exec`å‘½ä»¤æˆ–`oc rsh`å‘½ä»¤æ¥è®¿é—®åœ¨Openshiftå®¹å™¨å¹³å°é›†ç¾¤ä¸Šè¿è¡Œçš„å®¹å™¨ã€‚åœ¨æ‚¨çš„é•œåƒä¸­å®‰è£…å’Œè¿è¡Œsshdä¼šé­å—æ½œåœ¨æ”»å‡», éœ€è¦é¢å¤–çš„å®‰å…¨è¡¥ä¸ä¿®å¤ã€‚

### å°† VOLUMES ç”¨äºæŒä¹…æ•°æ®

é•œåƒåº”ä½¿ç”¨[å·](https://docs.docker.com/reference/builder/#volume)æ¥å­˜å‚¨æŒä¹…æ•°æ®ã€‚è¿™æ ·ï¼ŒKubernetesæˆ–OpenShift Container Platformå°†ç½‘ç»œå­˜å‚¨æŒ‚è½½åˆ°è¿è¡Œå®¹å™¨çš„èŠ‚ç‚¹ï¼Œå¦‚æœå®¹å™¨ç§»åŠ¨åˆ°æ–°èŠ‚ç‚¹ï¼Œåˆ™å­˜å‚¨å°†é‡æ–°è¿æ¥åˆ°è¯¥èŠ‚ç‚¹ã€‚é€šè¿‡å°†å·ç”¨äºæ‰€æœ‰æŒä¹…å­˜å‚¨éœ€æ±‚ï¼Œå³ä½¿é‡æ–°å¯åŠ¨æˆ–ç§»åŠ¨å®¹å™¨ï¼Œä¹Ÿä¼šä¿ç•™å†…å®¹ã€‚å¦‚æœæ‚¨çš„é•œåƒå°†æ•°æ®å†™å…¥å®¹å™¨å†…çš„ä»»æ„ä½ç½®ï¼Œåˆ™å¯èƒ½ä¸ä¼šä¿ç•™è¯¥å†…å®¹ã€‚

æ‰€æœ‰éœ€è¦ä¿å­˜çš„æ•°æ®ï¼Œå³ä½¿åœ¨å®¹å™¨è¢«é”€æ¯åï¼Œä¹Ÿå¿…é¡»å†™å…¥å·ã€‚å®¹å™¨å¼•æ“æ”¯æŒå®¹å™¨çš„`readonly`æ ‡å¿—ï¼Œå¯ç”¨äºä¸¥æ ¼æ‰§è¡Œæœ‰å…³ä¸å°†æ•°æ®å†™å…¥å®¹å™¨ä¸­çš„ä¸´æ—¶å­˜å‚¨çš„è‰¯å¥½å®è·µã€‚ç°åœ¨å›´ç»•è¿™ä¸ªåŠŸèƒ½è®¾è®¡æ‚¨çš„é•œåƒå°†ä½¿ä»¥åæ›´å®¹æ˜“åˆ©ç”¨å®ƒã€‚

æ­¤å¤–ï¼Œåœ¨*Dockerfile*ä¸­æ˜¾å¼å®šä¹‰å·ä½¿é•œåƒçš„æ¶ˆè´¹è€…å¾ˆå®¹æ˜“ç†è§£åœ¨è¿è¡Œé•œåƒæ—¶å¿…é¡»å®šä¹‰å“ªäº›å·ã€‚

æœ‰å…³å¦‚ä½•åœ¨Openshiftå®¹å™¨å¹³å°ä¸­ä½¿ç”¨å·çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… [Kubernetes documentation](https://kubernetes.io/docs/concepts/storage/volumes/).

> :grey_exclamation: æ³¨æ„:
>
> å³ä½¿ä½¿ç”¨æŒä¹…å·ï¼Œé•œåƒçš„æ¯ä¸ªå®ä¾‹éƒ½æœ‰è‡ªå·±çš„å·ï¼Œå¹¶ä¸”æ–‡ä»¶ç³»ç»Ÿåœ¨å®ä¾‹ä¹‹é—´ä¸å…±äº«ã€‚è¿™æ„å‘³ç€å·ä¸èƒ½ç”¨äºå…±äº«é›†ç¾¤ä¸­çš„çŠ¶æ€ã€‚

### ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨è¿›ç¨‹

é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerç”¨å®¹å™¨å†…éƒ¨çš„rootè¿è¡Œå®¹å™¨è¿›ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªç³Ÿç³•çš„åšæ³•ï¼Œå› ä¸ºå¦‚æœæ”»å‡»è€…è®¾æ³•çªç ´å®¹å™¨ï¼Œä»–ä»¬å¯ä»¥è·å¾—å¯¹Dockerä¸»æœºçš„rootæƒé™ã€‚

> :exclamation: æ³¨æ„:
>
> å¦‚æœæ‚¨æ˜¯å®¹å™¨ä¸­çš„rootï¼Œé‚£ä¹ˆæ‚¨å°†æ˜¯ä¸»æœºä¸Šçš„rootã€‚

### ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºåˆ›å»ºç²¾ç›Šä¸”ç”Ÿäº§å°±ç»ªçš„é•œåƒ

åˆ©ç”¨[å¤šé˜¶æ®µæ„å»º](https://docs.docker.com/develop/develop-images/multistage-build/)æ¥åˆ›å»ºä¸€ä¸ªç”¨äºæ„å»ºå·¥ä»¶çš„ä¸´æ—¶é•œåƒï¼Œè¯¥å·¥ä»¶å°†è¢«å¤åˆ¶åˆ°ç”Ÿäº§é•œåƒä¸Šã€‚ä¸´æ—¶æ„å»ºé•œåƒå°†ä¸ä¸è¯¥æ˜ åƒå…³è”çš„åŸå§‹æ–‡ä»¶ã€æ–‡ä»¶å¤¹å’Œä¾èµ–é¡¹ä¸€èµ·ä¸¢å¼ƒã€‚

è¿™ä¼šäº§ç”Ÿäº†ä¸€ä¸ªç²¾ç›Šï¼Œç”Ÿäº§å°±ç»ªçš„é•œåƒã€‚

ä¸€ä¸ªç”¨ä¾‹æ˜¯ä½¿ç”¨éAlpineåŸºç¡€é•œåƒæ¥å®‰è£…éœ€è¦ç¼–è¯‘çš„ä¾èµ–é¡¹ã€‚ç„¶åå¯ä»¥å°†wheelæ–‡ä»¶å¤åˆ¶åˆ°æœ€ç»ˆé•œåƒã€‚

Python ç¤ºä¾‹å¦‚ä¸‹:

```dockerfile
FROM python:3.6 as base
COPY requirements.txt /
RUN pip wheel --no-cache-dir --no-deps --wheel-dir /wheels -r requirements.txt

FROM python:3.6-alpine
COPY --from=base /wheels /wheels
COPY --from=base requirements.txt .
RUN pip install --no-cache /wheels/* # flask, gunicorn, pycrypto
WORKDIR /app
COPY . /app
```

ä½¿ç”¨å‰å¤§å°: 705MB, ä½¿ç”¨åå¤§å°: 103MB

### :exclamation: ç¦æ­¢åœ¨å®¹å™¨ä¸­å­˜å‚¨æœºå¯†ä¿¡æ¯

ç¦æ­¢åœ¨å®¹å™¨ä¸­å­˜å‚¨æœºå¯†ä¿¡æ¯, åŒ…æ‹¬:

- æ•æ„Ÿä¿¡æ¯ã€‚
- æ•°æ®åº“å‡­æ®ã€
- sshå¯†é’¥ã€
- ç”¨æˆ·åå’Œå¯†ç ã€
- apiä»¤ç‰Œç­‰ã€‚

ä»¥ä¸Šä¿¡æ¯å¯ä»¥é€šè¿‡: 

- ç¯å¢ƒå˜é‡ ENV  ä¼ é€’
- å·VOLUME æŒ‚è½½

### é¿å…å°†æ–‡ä»¶æ”¾å…¥`/tmp`ä¸­

å¯¹äºä¸€äº›è½¯ä»¶(å¦‚: pythonçš„gunicorn), ä¼šå°†æŸäº›ç¼“å­˜ä¿¡æ¯æˆ–å¿ƒè·³æ£€æµ‹ä¿¡æ¯å†™å…¥`/tmp`ä¸­, è¿™å¯¹`/tmp`çš„è¯»å†™æ€§èƒ½æœ‰è¾ƒé«˜è¦æ±‚, å¦‚æœ`/tmp`æŒ‚è½½çš„æ˜¯æ™®é€šç£ç›˜, å¯èƒ½å¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜.

åœ¨æŸäº›Linuxå‘è¡Œç‰ˆä¸­ï¼Œ`/tmp`é€šè¿‡`tmpfs`æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨åœ¨å†…å­˜ä¸­ã€‚ä½†æ˜¯ï¼ŒDockerå®¹å™¨é»˜è®¤æƒ…å†µä¸‹æ²¡æœ‰`/tmp`æ‰“å¼€`tmpfs`ï¼š

```bash
$ docker run --rm -it ubuntu:18.04 df
Filesystem       1K-blocks     Used Available Use% Mounted on
overlay           31263648 25656756   3995732  87% /
tmpfs                65536        0     65536   0% /dev
tmpfs              4026608        0   4026608   0% /sys/fs/cgroup
/dev/mapper/root  31263648 25656756   3995732  87% /etc/hosts
shm                  65536        0     65536   0% /dev/shm
```

å¦‚æ‚¨æ‰€è§ï¼Œ`/tmp`æ­£åœ¨ä½¿ç”¨æ ‡å‡†çš„Docker overlayæ–‡ä»¶ç³»ç»Ÿï¼šå®ƒç”±æ™®é€šçš„å—è®¾å¤‡æˆ–è®¡ç®—æœºæ­£åœ¨ä½¿ç”¨çš„ç¡¬ç›˜é©±åŠ¨å™¨æ”¯æŒã€‚è¿™å¯èƒ½å¯¼è‡´æ€§èƒ½é—®é¢˜ .

é’ˆå¯¹è¿™ç±»è½¯ä»¶, é€šç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†å…¶ä¸´æ—¶æ–‡ä»¶å­˜å‚¨åœ¨å…¶ä»–åœ°æ–¹ã€‚ç‰¹åˆ«æ˜¯ï¼Œå¦‚æœä½ çœ‹ä¸Šé¢ä½ ä¼šçœ‹åˆ°`/dev/shm`ä½¿ç”¨`shm`æ–‡ä»¶ç³»ç»Ÿå…±äº«å†…å­˜å’Œå†…å­˜æ–‡ä»¶ç³»ç»Ÿã€‚**æ‰€ä»¥ä½ éœ€è¦åšçš„å°±æ˜¯ä½¿ç”¨/dev/shmè€Œä¸æ˜¯/tmp**

### ~~ä½¿ç”¨ Alpine LinuxåŸºç¡€é•œåƒ(ä¸å»ºè®®é‡‡çº³)~~

ä½¿ç”¨åŸºäº[Alpine Linux](https://hub.docker.com/_/alpine/)çš„é•œåƒï¼Œå› ä¸ºå®ƒä»¬åªæä¾›æ‚¨éœ€è¦çš„åŒ…ã€‚ç”Ÿæˆçš„å›¾åƒå°†æ›´å°ã€‚

æ”¶ç›Šæœ‰:

1. å‡å°‘äº†ä¸»æœºæˆæœ¬ï¼Œå› ä¸ºä½¿ç”¨çš„ç£ç›˜ç©ºé—´æ›´å°‘
2. æ›´å¿«çš„æ„å»ºã€ä¸‹è½½å’Œè¿è¡Œæ—¶é—´
3. æ›´å®‰å…¨ï¼ˆå› ä¸ºåŒ…å’Œåº“æ›´å°‘ï¼‰
4. æ›´å¿«çš„éƒ¨ç½²

ç¤ºä¾‹å¦‚ä¸‹:

```dockerfile
FROM python:3.6-alpine
WORKDIR /app
COPY requirements.txt /
RUN pip install -r /requirements.txt  # flask and gunicorn
COPY . /app
```

ä½¿ç”¨å‰å¤§å°: 702MB, ä½¿ç”¨åå¤§å°: 102MB

### ä½¿ç”¨Red Hat å®˜æ–¹åŸºç¡€é•œåƒ

ä¸Šè¾¹ä¸€æ¡å…¶å®æˆ‘è§‰å¾—è¿™æ˜¯ä¸å¥½çš„å»ºè®®ã€‚æˆ‘å·²ç»çœ‹åˆ°äº†ä½¿ç”¨Alpine Linuxçš„äººä»¬æŠ¥å‘Šçš„ä¸€å¤§å †é—®é¢˜ï¼Œå› ä¸ºå®ƒå»ºç«‹åœ¨musl libcä¹‹ä¸Šï¼Œè€Œä¸æ˜¯å¤§å¤šæ•°Linuxå‘è¡Œç‰ˆä½¿ç”¨çš„GNU libcï¼ˆglibcï¼‰ã€‚é—®é¢˜èŒƒå›´ä»æ—¥æœŸæ—¶é—´æ ¼å¼çš„é”™è¯¯åˆ°ç”±äºè¾ƒå°çš„å †æ ˆå¯¼è‡´çš„å´©æºƒã€‚

å…¬å¹³åœ°è¯´ï¼Œè®¸å¤šæˆ–å¤§éƒ¨åˆ†é—®é¢˜å·²å¾—åˆ°è§£å†³ï¼Œä½†æ˜¯åœ¨ç”Ÿäº§ä¸­è°ƒè¯•è‡ªå·±çš„é”™è¯¯å·²ç»è¶³å¤Ÿç³Ÿç³•äº†ï¼Œä¸ºä»€ä¹ˆè¦å¢åŠ æ›´å¤šçš„æ½œåŠ›ä»¥è·å¾—æ›´å°çš„å›¾åƒå‘¢ï¼Ÿ

å› æ­¤ï¼Œæˆ‘å»ºè®®ä½¿ç”¨åŸºäºRedHatå®˜æ–¹çš„é•œåƒã€‚

[**Red Hat Container Catalog**](https://access.redhat.com/containers/#/explore)

### ä½¿ç”¨`.dockerignore`æ’é™¤æ— å…³æ–‡ä»¶

è¦æ’é™¤ä¸æ„å»ºæ— å…³çš„æ–‡ä»¶ï¼ˆä¸é‡æ„æºå­˜å‚¨åº“ï¼‰ï¼Œè¯·ä½¿ç”¨`.dockerignore`æ–‡ä»¶ã€‚æ­¤æ–‡ä»¶æ”¯æŒä¸`.gitignore`æ–‡ä»¶ç±»ä¼¼çš„æ’é™¤æ¨¡å¼ã€‚å…·ä½“è¯·å‚é˜… [.dockerignoreæ–‡ä»¶](https://docs.docker.com/engine/reference/builder/#dockerignore-file)ã€‚

### ä¸è¦å®‰è£…ä¸å¿…è¦çš„åŒ…

ä¸ºäº†é™ä½å¤æ‚æ€§ï¼Œä¾èµ–æ€§ï¼Œæ–‡ä»¶å¤§å°å’Œæ„å»ºæ—¶é—´ï¼Œè¯·é¿å…å®‰è£…é¢å¤–çš„æˆ–ä¸å¿…è¦çš„è½¯ä»¶åŒ…ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½â€œå¾ˆå¥½â€ã€‚ä¾‹å¦‚ï¼Œæ‚¨ä¸éœ€è¦åœ¨æ•°æ®åº“æ˜ åƒä¸­åŒ…å«æ–‡æœ¬ç¼–è¾‘å™¨ã€‚

### è§£è€¦åº”ç”¨ç¨‹åº

æ¯ä¸ªå®¹å™¨åº”è¯¥åªæœ‰ä¸€ä¸ªè¿›ç¨‹ã€‚å°†åº”ç”¨ç¨‹åºåˆ†ç¦»åˆ°å¤šä¸ªå®¹å™¨ä¸­å¯ä»¥æ›´å®¹æ˜“åœ°æ°´å¹³æ‰©å±•å’Œé‡ç”¨å®¹å™¨ã€‚ä¾‹å¦‚ï¼ŒWebåº”ç”¨ç¨‹åºå †æ ˆå¯èƒ½åŒ…å«ä¸‰ä¸ªç‹¬ç«‹çš„å®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨éƒ½æœ‰è‡ªå·±ç‹¬ç‰¹çš„æ˜ åƒï¼Œä»¥åˆ†ç¦»çš„æ–¹å¼ç®¡ç†Webåº”ç”¨ç¨‹åºï¼Œæ•°æ®åº“å’Œå†…å­˜ç¼“å­˜ã€‚

å°†æ¯ä¸ªå®¹å™¨é™åˆ¶ä¸ºä¸€ä¸ªè¿›ç¨‹æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ç»éªŒæ³•åˆ™ï¼Œä½†å®ƒä¸æ˜¯ä¸€ä¸ªç¡¬æ€§è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œä¸ä»…å¯ä»¥[ä½¿ç”¨initè¿›ç¨‹ç”Ÿæˆ](https://docs.docker.com/engine/reference/run/#specify-an-init-process)å®¹å™¨ ï¼Œè€Œä¸”æŸäº›ç¨‹åºå¯èƒ½ä¼šè‡ªè¡Œç”Ÿæˆå…¶ä»–è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œ[Celery](http://www.celeryproject.org/)å¯ä»¥ç”Ÿæˆå¤šä¸ªå·¥ä½œè¿›ç¨‹ï¼Œ[Apache](https://httpd.apache.org/)å¯ä»¥ä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªè¿›ç¨‹ã€‚

ä½¿ç”¨æ‚¨çš„æœ€ä½³åˆ¤æ–­ï¼Œå°½å¯èƒ½ä¿æŒå®¹å™¨æ¸…æ´å’Œæ¨¡å—åŒ–ã€‚å¦‚æœå®¹å™¨å½¼æ­¤ä¾èµ–ï¼Œåˆ™å¯ä»¥ä½¿ç”¨[Dockerå®¹å™¨ç½‘ç»œ](https://docs.docker.com/engine/userguide/networking/) æ¥ç¡®ä¿è¿™äº›å®¹å™¨å¯ä»¥è¿›è¡Œé€šä¿¡ã€‚

### å¯¹å¤šè¡Œå‚æ•°è¿›è¡Œæ’åº

åªè¦æœ‰å¯èƒ½ï¼Œé€šè¿‡æŒ‰å­—æ¯é¡ºåºæ’åºå¤šè¡Œå‚æ•°æ¥ç¼“è§£ä»¥åçš„æ›´æ”¹ã€‚è¿™æœ‰åŠ©äºé¿å…é‡å¤åŒ…å¹¶ä½¿åˆ—è¡¨æ›´å®¹æ˜“æ›´æ–°ã€‚è¿™ä¹Ÿä½¿PRæ›´å®¹æ˜“é˜…è¯»å’Œå®¡æŸ¥ã€‚åœ¨åæ–œæ ï¼ˆ`\`ï¼‰ä¹‹å‰æ·»åŠ ç©ºæ ¼ä¹Ÿæœ‰å¸®åŠ©ã€‚

ä¸‹é¢æ˜¯æ¥è‡ªä¸€ä¸ªç¤ºä¾‹[`buildpack-deps`å›¾åƒ](https://github.com/docker-library/buildpack-deps)ï¼š

```Dockerfile
RUN apt-get update && apt-get install -y \
  bzr \
  cvs \
  git \
  mercurial \
  subversion
```

## JAVA å®¹å™¨é•œåƒæŒ‡å—

### IDEæ’ä»¶æ¨è

- idea - è½¬åˆ°â€œé¦–é€‰é¡¹â€ã€â€œæ’ä»¶â€ã€â€œå®‰è£…JetBrainsæ’ä»¶â€¦â€ï¼Œæœç´¢â€œDockerâ€å¹¶å•å‡»â€œå®‰è£…â€
- Eclipse - 

> :notebook: å¤‡æ³¨:
>
> [Docker and IntelliJ IDEA](https://github.com/docker/labs/blob/master/developer-tools/java/chapters/ch07-intellij.adoc)
>
> [Docker and Eclipse](https://github.com/docker/labs/blob/master/developer-tools/java/chapters/ch07-eclipse.adoc#Docker_Eclipse)

### è®¾ç½®å†…å­˜é™åˆ¶ç›¸å…³å‚æ•°

> :notebook: å¤‡æ³¨:
>
> æŒ‡å®š`-Xmx=1g`å°†å‘Šè¯‰JVMåˆ†é…ä¸€ä¸ª1GBå †ã€‚å®ƒå¹¶æ²¡æœ‰å‘Šè¯‰JVMå°†å…¶æ•´ä¸ªå†…å­˜ä½¿ç”¨é‡é™åˆ¶ä¸º1GBã€‚è¿˜ä¼šæœ‰å¡card tablesã€ä»£ç ç¼“å­˜code cacheå’Œå„ç§å…¶ä»–å †å¤–æ•°æ®ç»“æ„ã€‚ç”¨äºæŒ‡å®šæ€»å†…å­˜ä½¿ç”¨é‡çš„å‚æ•°æ˜¯`-XX:MaxRAM`ã€‚è¯·æ³¨æ„ï¼Œä½¿ç”¨`-XX:MaxRam=500m`æ—¶ï¼Œå †å°†å¤§çº¦ä¸º250MBã€‚

Jvmåœ¨å†å²ä¸ŠæŸ¥æ‰¾`/proc`ä»¥ç¡®å®šæœ‰å¤šå°‘å¯ç”¨å†…å­˜ï¼Œç„¶åæ ¹æ®è¯¥å€¼è®¾ç½®å…¶å †å¤§å°ã€‚ä¸å¹¸çš„æ˜¯ï¼Œåƒdockerè¿™æ ·çš„å®¹å™¨åœ¨`/proc`ä¸­ä¸æä¾›ç‰¹å®šäºå®¹å™¨çš„ä¿¡æ¯ã€‚çº¢å¸½2017å¹´å·²ç»æå‡ºäº†ä¸€ä¸ªè¡¥ä¸ï¼Œå®ƒå·²ç»è¢«ä¸Šæ¸¸æ¥å—ï¼Œæä¾›äº†ä¸€ä¸ª`-XX:+UseCGroupMemoryLimitForHeap `å‘½ä»¤è¡Œå‚æ•°ï¼Œå®ƒå‘Šè¯‰jvmæŸ¥æ‰¾`/sys/fs/cgroup/memory/memory.limit_in_bytes`ï¼Œä»¥ç¡®å®šæœ‰å¤šå°‘å¯ç”¨å†…å­˜ã€‚å¦‚æœè¿™ä¸ªè¡¥ä¸åœ¨è¿è¡Œçš„OpenJDKç‰ˆæœ¬ä¸­ä¸å¯ç”¨ï¼Œå¯ä»¥é€šè¿‡æ˜¾å¼è®¾ç½®`-XX:MaxRAM=n`æ¥æ¨¡æ‹Ÿå®ƒã€‚

æ€»ç»“, è®¾ç½®å†…å­˜é™åˆ¶ç›¸å…³å‚æ•°:

1. openjdk 8 æ–°ç‰ˆæœ¬, æ·»åŠ : `-XX:+UseCGroupMemoryLimitForHeap `
2. å¦‚æœæ²¡æœ‰ä¸Šè¾¹çš„å‚æ•°, è®¾ç½®:`-XX:MaxRAM=n `
3. å»ºè®®è®¾ç½®JVM Heapçº¦ä¸º memory limitçš„80%
4. å»ºè®®è®¾ç½®JVM MaxRAMæ¥è¿‘memory limit

### è®¾ç½®GCç­–ç•¥

OpenJDK8ä¸­æœ‰ä¸€ä¸ªè¡¥ä¸ï¼Œå®ƒå°†ä½¿ç”¨cgroupå¯ç”¨çš„ä¿¡æ¯æ¥è®¡ç®—é€‚å½“æ•°é‡çš„å¹¶è¡ŒGCçº¿ç¨‹ã€‚ä½†æ˜¯ï¼Œå¦‚æœè¿™ä¸ªè¡¥ä¸åœ¨æ‚¨çš„OpenJDKç‰ˆæœ¬ä¸­ä¸å¯ç”¨ï¼Œé‚£ä¹ˆæ‚¨æœ€ç»ˆå¯èƒ½ä¼šå¾—åˆ°8ä¸ªå¹¶è¡ŒGCçº¿ç¨‹ï¼Œå¹¶ä¸”å®¹å™¨ä¸­åªæœ‰2ä¸ªCPUã€‚è§£å†³æ–¹æ³•æ˜¯æ˜¾å¼æŒ‡å®šå¹¶è¡ŒGCçº¿ç¨‹çš„æ•°é‡ã€‚`-XX:ParallelGCThreads=2` ã€‚~~å¦‚æœæ‚¨çš„å®¹å™¨ä¸­é™å®šåªæœ‰ä¸€ä¸ªCPUï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨`-XX:+UseSerialGC`è¿è¡Œï¼Œå¹¶å®Œå…¨é¿å…å¹¶è¡ŒGCã€‚~~

### JAVAå¯åŠ¨é˜¶æ®µè°ƒä¼˜

JAVAç¨‹åºéƒ½æœ‰ä¸€ä¸ªå¯åŠ¨é˜¶æ®µï¼Œå®ƒéœ€è¦å¤§é‡çš„å †ï¼Œä½†ä¼šè¿›å…¥ä¸€ä¸ªå®‰é™çš„å¾ªç¯é˜¶æ®µï¼Œåœ¨è¿™ä¸ªé˜¶æ®µå®ƒä¸éœ€è¦å¤ªå¤šã€‚

å¯¹äºä¸²è¡ŒGCç­–ç•¥, ä½ å¯ä»¥è¦æ±‚å®ƒæ›´å…·ä¾µç•¥æ€§. `-XX:MinHeapFreeRatio=20 `(å½“å †å ç”¨ç‡å¤§äº80%æ—¶ï¼Œæ­¤å€¼é»˜è®¤å¢å¤§ã€‚)

`XX:MaxHeapFreeRatio=40`(å †å ç”¨ç‡å°äº60%æ—¶æ”¶ç¼©)

å¯¹äºå¹¶è¡Œ - parallel GCç­–ç•¥, æ¨èå¦‚ä¸‹é…ç½®:

`-XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90`

### JAVAå®¹å™¨å…¨å±€å»ºè®®èµ„æºè¯·æ±‚å’Œèµ„æºé™åˆ¶

JAVAç¨‹åºéƒ½æœ‰ä¸€ä¸ªå¯åŠ¨é˜¶æ®µï¼Œå¯åŠ¨é˜¶æ®µä¹Ÿä¼šå¤§é‡æ¶ˆè€—CPU, CPUä½¿ç”¨è¶Šå¤š, å¯åŠ¨é˜¶æ®µè¶ŠçŸ­.
ä¸‹é¢æ˜¯ä¸€ä¸ªè¡¨ï¼Œæ€»ç»“äº†ä¸åŒCPUé™åˆ¶ä¸‹çš„spring boot ç¤ºä¾‹åº”ç”¨å¯åŠ¨æ—¶é—´(åœ¨millicoreä¸­):

- 500m â€” 80 seconds
- 1000m â€” 35 seconds
- 1500m â€” 22 seconds
- 2500m â€” 17 seconds
- 3000m â€” 12 seconds

æ ¹æ®ä»¥ä¸Šæƒ…å†µ, å®¹å™¨å¹³å°ç®¡ç†å‘˜è€ƒè™‘å¯¹JAVAå®¹å™¨åšå¦‚ä¸‹é™åˆ¶:

- ä½¿ç”¨CPU requests, ä¸è®¾ç½®cpu limit (KubernetesåŠŸèƒ½)
- ä½¿ç”¨memory limitç­‰äºmemory request

```yaml
resources:
  requests:
    memory: "1024Mi"
    cpu: "500m"
  limits:
    memory: "1024Mi"
```

## NGINX å®¹å™¨é•œåƒæŒ‡å—

å¦‚æœæ‚¨ç›´æ¥åœ¨åŸºç¡€ç¡¬ä»¶æˆ–è™šæ‹Ÿæœºä¸Šè¿è¡ŒNGINXï¼Œé€šå¸¸éœ€è¦ä¸€ä¸ªNGINXå®ä¾‹æ¥ä½¿ç”¨æ‰€æœ‰å¯ç”¨çš„CPUã€‚ç”±äºNGINXæ˜¯å¤šè¿›ç¨‹æ¨¡å¼ï¼Œé€šå¸¸ä½ ä¼šå¯åŠ¨å¤šä¸ªworker processesï¼Œæ¯ä¸ªå·¥ä½œè¿›ç¨‹éƒ½æ˜¯ä¸åŒçš„è¿›ç¨‹ï¼Œä»¥ä¾¿åˆ©ç”¨æ‰€æœ‰CPUã€‚

ä½†æ˜¯ï¼Œåœ¨å®¹å™¨ä¸­è¿è¡Œæ—¶ï¼Œé€šå¸¸ä¼šåœ¨é€šè¿‡è¿è¡Œæ›´å¤šå®¹å™¨æ¥æ‰©å±•çš„ç¯å¢ƒä¸­ã€‚Kubernetesï¼šæ‰€æœ‰è¿™äº›éƒ½éšè—äº†ç¡¬ä»¶ï¼Œå¹¶æœŸæœ›é€šè¿‡ç¼©æ”¾å¤šä¸ªå®¹å™¨æ¥åˆ©ç”¨å¤šä¸ªCPUã€‚

å› æ­¤ï¼Œ:+1:å»ºè®®åªéœ€ä¸€ä¸ªæˆ–ä¸¤ä¸ªå·¥ä½œè¿›ç¨‹å³å¯å¼€å§‹ä½¿ç”¨NGINXã€‚

```nginx
worker_processes  1;  # æˆ–autoæˆ–2
```



## Python å®¹å™¨é•œåƒæŒ‡å—

ç¤ºä¾‹å¦‚ä¸‹:

```dockerfile
# pull official base image
FROM python:3.7-alpine

# set work directory
WORKDIR /app

# set environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV DEBUG 0

# install psycopg2
RUN apk update \
    && apk add --virtual build-deps gcc python3-dev musl-dev \
    && apk add postgresql-dev \
    && pip install psycopg2 \
    && apk del build-deps

# install dependencies
COPY ./requirements.txt .
RUN pip install -r requirements.txt

# copy project
COPY . .

# add and run as non-root user
RUN adduser -D myuser
USER myuser

# run gunicorn
CMD gunicorn hello_django.wsgi:application --bind 0.0.0.0:$PORT
```

â–³ ç¤ºä¾‹Dockerfile

### IDEæ’ä»¶æ¨è

- PyCharm - åŒIdea
- VSCode - **Visual Studio Code Remote - Containers** æ’ä»¶ 
    - [Developing inside a Container](https://code.visualstudio.com/docs/remote/containers)

### å»ºè®®é…ç½®çš„ç¯å¢ƒå˜é‡

```dockerfile
# set environment variables
ENV PYTHONDONTWRITEBYTECODE 1
ENV PYTHONUNBUFFERED 1
ENV DEBUG 0
```

1. `PYTHONDONTWRITEBYTECODE`: é˜²æ­¢pythonå°†pycæ–‡ä»¶å†™å…¥ç¡¬ç›˜
2. `PYTHONUNBUFFERED`: é˜²æ­¢pythonç¼“å†²stdoutå’Œstderr
3. `DEBUG`: æ–¹ä¾¿æ ¹æ®ç¯å¢ƒç±»å‹çš„ä¸åŒ(æµ‹è¯•/ç”Ÿäº§)è°ƒæ•´æ˜¯å¦å¼€å¯debug

### å®‰è£…æ•°æ®åº“é©±åŠ¨åŒ…çš„æ–¹æ³•

ä»¥postgredbçš„é©±åŠ¨psycopg2ä¸ºä¾‹:

```dockerfile
# install psycopg2
RUN apk update \
    && apk add --virtual build-deps gcc python3-dev musl-dev \
    && apk add postgresql-dev \
    && pip install psycopg2 \
    && apk del build-deps
```





## Openshift å®¹å™¨å¹³å°ç‰¹å®šæŒ‡å—

ä»¥ä¸‹æ˜¯åˆ›å»ºä¸“é—¨ç”¨äºOpenshiftå®¹å™¨å¹³å°çš„å®¹å™¨é•œåƒæ—¶é€‚ç”¨çš„å‡†åˆ™ã€‚

### å¯ç”¨æºåˆ°æ˜ åƒï¼ˆS2Iï¼‰åŠŸèƒ½

å¯¹äºæ‰“ç®—è¿è¡Œç”±ç¬¬ä¸‰æ–¹æä¾›çš„åº”ç”¨ç¨‹åºä»£ç çš„é•œåƒï¼Œä¾‹å¦‚ä¸ºè¿è¡Œå¼€å‘äººå‘˜æä¾›çš„javaä»£ç è€Œè®¾è®¡çš„javaé•œåƒï¼Œæ‚¨å¯ä»¥ä½¿æ‚¨çš„é•œåƒä¸[æºåˆ°æ˜ åƒï¼ˆS2Iï¼‰](https://github.com/openshift/source-to-image)æ„å»ºå·¥å…·ä¸€èµ·å·¥ä½œã€‚

:+1: S2I æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œå®ƒä½¿å¾—ç¼–å†™**ä»¥åº”ç”¨ç¨‹åºæºä»£ç ä¸ºè¾“å…¥**çš„é•œåƒå’Œç”Ÿæˆ**ä»¥è¿è¡Œç»„åˆåº”ç”¨ç¨‹åºä¸ºè¾“å‡ºçš„æ–°é•œåƒ**å˜å¾—å®¹æ˜“ã€‚

ä¾‹å¦‚ï¼Œè¿™ä¸ª[pythoné•œåƒ](https://github.com/sclorg/s2i-python-container)å®šä¹‰äº†ç”¨äºæ„å»ºå„ç§ç‰ˆæœ¬çš„pythonåº”ç”¨ç¨‹åºçš„s2iè„šæœ¬ã€‚

### æ”¯æŒä»»æ„ç”¨æˆ·ID

é»˜è®¤æƒ…å†µä¸‹ï¼Œopenshiftå®¹å™¨å¹³å°ä½¿ç”¨ä»»æ„åˆ†é…çš„ç”¨æˆ·IDè¿è¡Œå®¹å™¨ã€‚è¿™æä¾›äº†é¢å¤–çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢å› å®¹å™¨å¼•æ“æ¼æ´è€Œé€ƒé€¸å®¹å™¨çš„è¿›ç¨‹ï¼Œä»è€Œåœ¨ä¸»æœºèŠ‚ç‚¹ä¸Šè·å–æ›´é«˜çº§çš„æƒé™ã€‚

å¯¹äºæ”¯æŒä»¥ä»»æ„ç”¨æˆ·èº«ä»½è¿è¡Œçš„é•œåƒï¼Œå¯ä»¥ç”±é•œåƒä¸­çš„è¿›ç¨‹å†™å…¥çš„ç›®å½•å’Œæ–‡ä»¶åº”å½’æ ¹ç»„æ‰€æœ‰ï¼Œå¹¶ç”±è¯¥ç»„è¯»/å†™ã€‚è¦æ‰§è¡Œçš„æ–‡ä»¶è¿˜åº”å…·æœ‰ç»„æ‰§è¡Œæƒé™ã€‚

å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°Dockerfileå°†è®¾ç½®ç›®å½•å’Œæ–‡ä»¶æƒé™ï¼Œä»¥å…è®¸æ ¹ç»„ä¸­çš„ç”¨æˆ·åœ¨ç”Ÿæˆçš„é•œåƒä¸­è®¿é—®å®ƒä»¬ï¼š

```dockerfile
RUN chgrp -R 0 /some/directory && \
    chmod -R g=u /some/directory
```

å› ä¸ºå®¹å™¨ç”¨æˆ·å§‹ç»ˆæ˜¯æ ¹ç»„çš„æˆå‘˜ï¼Œæ‰€ä»¥å®¹å™¨ç”¨æˆ·å¯ä»¥è¯»å†™è¿™äº›æ–‡ä»¶ã€‚æ ¹ç»„æ²¡æœ‰ä»»ä½•ç‰¹æ®Šæƒé™ï¼ˆä¸æ ¹ç”¨æˆ·ä¸åŒï¼‰ï¼Œå› æ­¤è¿™ç§å®‰æ’ä¸å­˜åœ¨å®‰å…¨é—®é¢˜ã€‚æ­¤å¤–ï¼Œ**åœ¨å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¸èƒ½ç›‘å¬ç‰¹æƒç«¯å£ï¼ˆä½äº1024çš„ç«¯å£ï¼‰**ï¼Œå› ä¸ºå®ƒä»¬ä¸æ˜¯ä½œä¸ºç‰¹æƒç”¨æˆ·è¿è¡Œçš„ã€‚

å› ä¸ºå®¹å™¨çš„ç”¨æˆ·IDæ˜¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œæ‰€ä»¥åœ¨`/etc/passwd`ä¸­ä¸ä¼šæœ‰å…³è”çš„æ¡ç›®ã€‚è¿™å¯èƒ½ä¼šç»™å¸Œæœ›èƒ½å¤ŸæŸ¥æ‰¾å…¶ç”¨æˆ·IDçš„åº”ç”¨ç¨‹åºå¸¦æ¥é—®é¢˜ã€‚è§£å†³æ­¤é—®é¢˜çš„ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å®¹å™¨çš„ç”¨æˆ·IDåŠ¨æ€åˆ›å»ºä¸€ä¸ª`passwd`æ–‡ä»¶æ¡ç›®ï¼Œä½œä¸ºé•œåƒçš„å¯åŠ¨è„šæœ¬çš„ä¸€éƒ¨åˆ†ã€‚è¿™å°±æ˜¯Dockerfileå¯èƒ½åŒ…å«çš„å†…å®¹ï¼š

```dockerfile
RUN chmod g=u /etc/passwd
ENTRYPOINT [ "uid_entrypoint" ]
USER 1001
```

å…¶ä¸­`uid_entrypoint`åŒ…å«ï¼š

```bash
if ! whoami &> /dev/null; then
  if [ -w /etc/passwd ]; then
    echo "${USER_NAME:-default}:x:$(id -u):0:${USER_NAME:-default} user:${HOME}:/sbin/nologin" >> /etc/passwd
  fi
fi
```

æœ‰å…³æ­¤çš„å®Œæ•´ç¤ºä¾‹ï¼Œè¯·å‚è§[æ­¤dockerfile](https://github.com/RHsyseng/container-rhel-examples/blob/master/starter-arbitrary-uid/Dockerfile)ã€‚

æœ€åï¼Œ**dockerfileä¸­çš„æœ€ç»ˆ`USER`å£°æ˜åº”è¯¥æŒ‡å®šç”¨æˆ·IDï¼ˆæ•°å€¼ï¼‰ï¼Œè€Œä¸æ˜¯ç”¨æˆ·å**ã€‚è¿™å…è®¸openshiftå®¹å™¨å¹³å°éªŒè¯é•œåƒè¯•å›¾ä½¿ç”¨çš„æƒé™ï¼Œå¹¶é˜»æ­¢è¿è¡Œè¯•å›¾ä½œä¸ºrootè¿è¡Œçš„é•œåƒï¼Œå› ä¸ºä½œä¸ºç‰¹æƒç”¨æˆ·è¿è¡Œå®¹å™¨ä¼šæš´éœ²æ½œåœ¨çš„å®‰å…¨æ¼æ´ã€‚å¦‚æœé•œåƒæœªæŒ‡å®šç”¨æˆ·ï¼Œåˆ™å®ƒä»çˆ¶æ˜ åƒç»§æ‰¿`USER`ã€‚

> :exclamation: æ³¨æ„:
>
> å¦‚æœæ‚¨çš„S2Ié•œåƒä¸åŒ…å«å¸¦æœ‰æ•°å­—ç”¨æˆ·çš„`USER`å£°æ˜ï¼Œåˆ™é»˜è®¤æƒ…å†µä¸‹ï¼Œæ„å»ºå°†å¤±è´¥ã€‚ä¸ºäº†å…è®¸ä½¿ç”¨å‘½åç”¨æˆ·æˆ–rootï¼ˆ0ï¼‰ç”¨æˆ·åœ¨Openshiftå®¹å™¨å¹³å°ä¸­æ„å»ºæ˜ åƒï¼Œå¯ä»¥æ·»åŠ é¡¹ç›®çš„builderæœåŠ¡å¸æˆ·ï¼ˆ`system:serviceaccount:<your-project>:builder`ï¼‰æ·»åŠ åˆ°ç‰¹æƒå®‰å…¨ä¸Šä¸‹æ–‡çº¦æŸï¼ˆsccï¼‰ã€‚æˆ–è€…ï¼Œæ‚¨å¯ä»¥å…è®¸æ‰€æœ‰é•œåƒä½œä¸ºä»»ä½•ç”¨æˆ·è¿è¡Œã€‚

### ä½¿ç”¨æœåŠ¡ SERVICE è¿›è¡Œé•œåƒé—´é€šä¿¡

å¯¹äºæ‚¨çš„é•œåƒéœ€è¦ä¸å¦ä¸€ä¸ªé•œåƒæä¾›çš„æœåŠ¡é€šä¿¡çš„æƒ…å†µï¼Œä¾‹å¦‚éœ€è¦è®¿é—®æ•°æ®åº“é•œåƒä»¥å­˜å‚¨å’Œæ£€ç´¢æ•°æ®çš„Webå‰ç«¯é•œåƒï¼Œæ‚¨çš„é•œåƒåº”è¯¥ä½¿ç”¨Openshiftå®¹å™¨å¹³å°çš„æœåŠ¡ - serviceã€‚æœåŠ¡ - serviceä¸ºè®¿é—®æä¾›ä¸€ä¸ªé™æ€ç«¯ç‚¹ï¼Œè¯¥ç«¯ç‚¹ä¸ä¼šéšç€å®¹å™¨çš„åœæ­¢ã€å¯åŠ¨æˆ–ç§»åŠ¨è€Œæ›´æ”¹ã€‚æ­¤å¤–ï¼ŒæœåŠ¡è¿˜ä¸ºè¯·æ±‚æä¾›è´Ÿè½½å¹³è¡¡ã€‚

### æä¾›å…¬å…±åº“

å¯¹äºæ‰“ç®—è¿è¡Œç”±ç¬¬ä¸‰æ–¹æä¾›çš„åº”ç”¨ç¨‹åºä»£ç çš„é•œåƒï¼Œè¯·ç¡®ä¿æ‚¨çš„é•œåƒåŒ…å«å¹³å°çš„å¸¸ç”¨åº“ã€‚ç‰¹åˆ«æ˜¯ï¼Œä¸ºä¸å¹³å°ä¸€èµ·ä½¿ç”¨çš„å…¬å…±æ•°æ®åº“æä¾›æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨åˆ›å»ºJavaæ¡†æ¶é•œåƒï¼Œåˆ™ä¸ºMySQLå’ŒPostgreSQLæä¾›JDBCé©±åŠ¨ç¨‹åºã€‚è¿™æ ·åšå¯ä»¥é˜²æ­¢åœ¨åº”ç”¨ç¨‹åºè£…é…æœŸé—´ä¸‹è½½å…¬å…±ä¾èµ–é¡¹ï¼Œä»è€ŒåŠ å¿«åº”ç”¨ç¨‹åºé•œåƒçš„æ„å»ºã€‚å®ƒè¿˜ç®€åŒ–äº†åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜æ‰€éœ€çš„å·¥ä½œï¼Œä»¥ç¡®ä¿æ»¡è¶³å…¶æ‰€æœ‰ä¾èµ–é¡¹ã€‚

### ä½¿ç”¨ç¯å¢ƒå˜é‡è¿›è¡Œé…ç½®

æ‚¨çš„é•œåƒçš„ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿé…ç½®å®ƒï¼Œè€Œä¸å¿…æ ¹æ®æ‚¨çš„é•œåƒåˆ›å»ºä¸‹æ¸¸é•œåƒã€‚è¿™æ„å‘³ç€è¿è¡Œæ—¶é…ç½®åº”è¯¥ä½¿ç”¨ç¯å¢ƒå˜é‡æ¥å¤„ç†ã€‚å¯¹äºä¸€ä¸ªç®€å•çš„é…ç½®ï¼Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å¯ä»¥ç›´æ¥ä½¿ç”¨ç¯å¢ƒå˜é‡ã€‚å¯¹äºæ›´å¤æ‚çš„é…ç½®æˆ–ä¸æ”¯æŒæ­¤é…ç½®çš„è¿è¡Œæ—¶ï¼Œé€šè¿‡å®šä¹‰åœ¨å¯åŠ¨æœŸé—´å¤„ç†çš„æ¨¡æ¿é…ç½®æ–‡ä»¶æ¥é…ç½®è¿è¡Œæ—¶ã€‚åœ¨æ­¤å¤„ç†è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥å°†ä½¿ç”¨ç¯å¢ƒå˜é‡æä¾›çš„å€¼æ›¿æ¢åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ç”¨äºå†³å®šåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®å“ªäº›é€‰é¡¹ã€‚

å¦å¤–**å»ºè®®ä½¿ç”¨ç¯å¢ƒå˜é‡å°†è¯ä¹¦å’Œå¯†é’¥ç­‰æœºå¯†ä¿¡æ¯ä¼ é€’åˆ°å®¹å™¨ä¸­**ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æœºå¯†å€¼ä¸ä¼šæœ€ç»ˆæäº¤åˆ°é•œåƒä¸­å¹¶æ³„æ¼åˆ°å®¹å™¨é•œåƒæ³¨å†Œè¡¨ä¸­ã€‚

æä¾›ç¯å¢ƒå˜é‡å…è®¸é•œåƒçš„ä½¿ç”¨è€…è‡ªå®šä¹‰è¡Œä¸ºï¼Œå¦‚æ•°æ®åº“è®¾ç½®ã€å¯†ç å’Œæ€§èƒ½è°ƒæ•´ï¼Œè€Œä¸å¿…åœ¨é•œåƒä¸Šå¼•å…¥æ–°çš„å±‚ã€‚ç›¸åï¼Œå®ƒä»¬å¯ä»¥åœ¨å®šä¹‰PODæ—¶ç®€å•åœ°å®šä¹‰ç¯å¢ƒå˜é‡å€¼ï¼Œå¹¶åœ¨ä¸é‡å»ºé•œåƒçš„æƒ…å†µä¸‹æ›´æ”¹è¿™äº›è®¾ç½®ã€‚

å¯¹äºéå¸¸å¤æ‚çš„åœºæ™¯ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¿è¡Œæ—¶æŒ‚è½½åˆ°å®¹å™¨ä¸­çš„å·æ¥æä¾›é…ç½®ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨é€‰æ‹©è¿™æ ·åšï¼Œåˆ™å¿…é¡»ç¡®ä¿å½“ä¸å­˜åœ¨æ‰€éœ€çš„å·æˆ–é…ç½®æ—¶ï¼Œé•œåƒåœ¨å¯åŠ¨æ—¶æä¾›æ¸…æ™°çš„é”™è¯¯æ¶ˆæ¯ã€‚

æ­¤ä¸»é¢˜ä¸åœ¨[ä½¿ç”¨æœåŠ¡ SERVICE è¿›è¡Œé•œåƒé—´é€šä¿¡](#ä½¿ç”¨æœåŠ¡ SERVICE è¿›è¡Œé•œåƒé—´é€šä¿¡)ç›¸å…³ï¼Œä¾‹å¦‚ï¼Œåº”æ ¹æ®æä¾›æœåŠ¡ - service ç«¯ç‚¹ä¿¡æ¯çš„ç¯å¢ƒå˜é‡å®šä¹‰æ•°æ®æºã€‚è¿™å…è®¸åº”ç”¨ç¨‹åºåœ¨ä¸ä¿®æ”¹åº”ç”¨ç¨‹åºé•œåƒçš„æƒ…å†µä¸‹åŠ¨æ€ä½¿ç”¨Openshiftå®¹å™¨å¹³å°ç¯å¢ƒä¸­å®šä¹‰çš„æ•°æ®æºæœåŠ¡ - serviceã€‚

æ­¤å¤–ï¼Œåº”è¯¥é€šè¿‡æ£€æŸ¥å®¹å™¨çš„**cgroups**è®¾ç½®æ¥è¿›è¡Œç›¸åº”è°ƒæ•´ã€‚è¿™å…è®¸é•œåƒå°†è‡ªå·±è°ƒåˆ°å¯ç”¨å†…å­˜ã€CPUå’Œå…¶ä»–èµ„æºã€‚ä¾‹å¦‚ï¼ŒåŸºäºJavaçš„é•œåƒåº”è¯¥æ ¹æ®**cgroup**æœ€å¤§å†…å­˜å‚æ•°æ¥è°ƒæ•´å®ƒä»¬çš„å † - heapï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¸è¶…è¿‡é™åˆ¶å¹¶è·å¾—å†…å­˜ä¸è¶³out-of-memoryçš„é”™è¯¯ã€‚

æœ‰å…³å¦‚ä½•ç®¡ç†å®¹å™¨ä¸­çš„cgroupé…é¢çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…ä»¥ä¸‹å‚è€ƒï¼š

- Blog article - [Resource management in Docker](https://goldmann.pl/blog/2014/09/11/resource-management-in-docker)
- Docker documentation - [Runtime Metrics](https://docs.docker.com/engine/admin/runmetrics/)
- Blog article - [Memory inside Linux containers](http://fabiokung.com/2014/03/13/memory-inside-linux-containers)

### è€ƒè™‘é›†ç¾¤æ–¹æ¡ˆ

æ‚¨å¿…é¡»å®Œå…¨ç†è§£è¿è¡Œé•œåƒçš„å¤šä¸ªå®ä¾‹æ„å‘³ç€ä»€ä¹ˆã€‚åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡çš„è´Ÿè½½å¹³è¡¡åŠŸèƒ½å¤„ç†å°†æµé‡è·¯ç”±åˆ°é•œåƒçš„æ‰€æœ‰å®ä¾‹ã€‚ä½†æ˜¯ï¼Œè®¸å¤šæ¡†æ¶å¿…é¡»å…±äº«ä¿¡æ¯æ‰èƒ½æ‰§è¡Œé¢†å¯¼äººé€‰ä¸¾æˆ–æ•…éšœè½¬ç§»çŠ¶æ€ï¼›ä¾‹å¦‚ï¼Œåœ¨ä¼šè¯å¤åˆ¶ä¸­ã€‚

è€ƒè™‘åœ¨Openshiftå®¹å™¨å¹³å°ä¸­è¿è¡Œæ—¶ï¼Œæ‚¨çš„å®ä¾‹å¦‚ä½•å®Œæˆæ­¤é€šä¿¡ã€‚è™½ç„¶podå¯ä»¥ç›´æ¥ç›¸äº’é€šä¿¡ï¼Œä½†åªè¦podå¯åŠ¨ã€åœæ­¢æˆ–ç§»åŠ¨ï¼Œå®ƒä»¬çš„IPåœ°å€å°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚å› æ­¤ï¼Œé›†ç¾¤æ–¹æ¡ˆå¿…é¡»æ˜¯åŠ¨æ€çš„ã€‚

### è®°å½•æ—¥å¿—

:+1: æœ€å¥½å°†**æ‰€æœ‰æ—¥å¿—å‘é€åˆ°æ ‡å‡†è¾“å‡º**ã€‚Openshiftå®¹å™¨å¹³å°ä»å®¹å™¨ä¸­æ”¶é›†æ ‡å‡†è¾“å‡ºï¼Œå¹¶å°†å…¶å‘é€åˆ°é›†ä¸­æ—¥å¿—è®°å½•æœåŠ¡(ELKæŠ€æœ¯æ ˆ)ï¼Œåœ¨é‚£é‡Œå¯ä»¥æŸ¥çœ‹ã€‚å¦‚æœå¿…é¡»åˆ†éš”æ—¥å¿—å†…å®¹ï¼Œè¯·åœ¨è¾“å‡ºå‰é¢åŠ ä¸Šé€‚å½“çš„å…³é”®å­—ï¼Œè¿™æ ·å¯ä»¥ç­›é€‰æ¶ˆæ¯ã€‚

å¦‚æœæ‚¨çš„é•œåƒè®°å½•æ—¥å¿—åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆç”¨æˆ·å¿…é¡»ä½¿ç”¨æ‰‹åŠ¨æ“ä½œæ¥è¾“å…¥æ­£åœ¨è¿è¡Œçš„å®¹å™¨å¹¶æ£€ç´¢æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ã€‚

### LIVENESSæ´»æ€§æ¢é’ˆå’ŒREADINESS å°±ç»ªæ¢é’ˆ

è®°å½•å¯ç”¨äºé•œåƒçš„æ´»æ€§å’Œå°±ç»ªæ¢é’ˆç¤ºä¾‹ã€‚è¿™äº›æ¢é’ˆå°†å…è®¸ç”¨æˆ·éƒ¨ç½²æ‚¨çš„é•œåƒï¼Œå¹¶ç¡®ä¿åœ¨æœªå°±ç»ªä¹‹å‰ä¸ä¼šå°†æµé‡è·¯ç”±åˆ°å®¹å™¨ï¼Œå¹¶ä¸”å¦‚æœè¿›ç¨‹è¿›å…¥ä¸å¥åº·çŠ¶æ€ï¼Œå°†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚

### æ¨¡æ¿ - TEMPLATE

è€ƒè™‘ä¸ºé•œåƒæä¾›ä¸€ä¸ªç¤ºä¾‹æ¨¡æ¿ã€‚æ¨¡æ¿å°†ä¸ºç”¨æˆ·æä¾›ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œä½¿æ‚¨å¯ä»¥ä½¿ç”¨æœ‰ç”¨çš„é…ç½®å¿«é€Ÿéƒ¨ç½²å›¾åƒã€‚ä¸ºäº†å®Œæ•´æ€§ï¼Œæ‚¨çš„æ¨¡æ¿åº”è¯¥åŒ…æ‹¬æ‚¨ç”¨é•œåƒè®°å½•çš„æ´»æ€§å’Œå°±ç»ªæ¢é’ˆã€‚

***é¢å¤–èµ„æº***:

- [Docker basics](https://docs.docker.com/engine/docker-overview/)
- [Dockerfile reference](https://docs.docker.com/engine/reference/builder/)
- [Project Atomic Guidance for Container Image Authors](http://www.projectatomic.io/docs/docker-image-author-guidance)

### åœ¨é•œåƒä¸­åŒ…æ‹¬å…ƒæ•°æ®

å®šä¹‰é•œåƒå…ƒæ•°æ®æœ‰åŠ©äºOpenshiftå®¹å™¨å¹³å°æ›´å¥½åœ°ä½¿ç”¨å®¹å™¨é•œåƒï¼Œå…è®¸Openshiftå®¹å™¨å¹³å°ä¸ºä½¿ç”¨æ‚¨çš„é•œåƒçš„å¼€å‘äººå‘˜åˆ›å»ºæ›´å¥½çš„ä½“éªŒã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æ·»åŠ å…ƒæ•°æ®æ¥æä¾›é•œåƒçš„æœ‰ç”¨æè¿°ï¼Œæˆ–è€…å¯¹å…¶ä»–å¯èƒ½éœ€è¦çš„é•œåƒæä¾›å»ºè®®ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨`dockerfile`ä¸­çš„`label`æŒ‡ä»¤æ¥å®šä¹‰é•œåƒå…ƒæ•°æ®ã€‚æ ‡ç­¾ - labelç±»ä¼¼äºç¯å¢ƒå˜é‡ï¼Œå› ä¸ºå®ƒä»¬æ˜¯é™„åŠ åˆ°é•œåƒæˆ–å®¹å™¨çš„é”®å€¼å¯¹ã€‚æ ‡ç­¾ä¸åŒäºç¯å¢ƒå˜é‡ï¼Œå› ä¸ºå®ƒä»¬å¯¹æ­£åœ¨è¿è¡Œçš„åº”ç”¨ç¨‹åºä¸å¯è§ï¼Œä½†æ˜¯å¯ä»¥ç”¨äºå¿«é€ŸæŸ¥æ‰¾é•œåƒå’Œå®¹å™¨ã€‚

æ ‡ç­¾åç§°é€šå¸¸åº”å…·æœ‰åç§°ç©ºé—´ã€‚åº”ç›¸åº”åœ°è®¾ç½®åç§°ç©ºé—´ï¼Œä»¥åæ˜ å°†è¦æ‹¾å–æ ‡ç­¾å¹¶ä½¿ç”¨å®ƒä»¬çš„é¡¹ç›®ã€‚å¯¹äºopenshiftå®¹å™¨å¹³å°ï¼Œå‘½åç©ºé—´åº”è®¾ç½®ä¸º`io.openshift`ï¼Œå¯¹äºkubernetesï¼Œå‘½åç©ºé—´ä¸º`io.k8s`ã€‚

æœ‰å…³æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[Dockerè‡ªå®šä¹‰å…ƒæ•°æ®æ–‡æ¡£](https://docs.docker.com/engine/userguide/labels-custom-metadata)ã€‚

| Variable                                           | Description                                                  |
| :------------------------------------------------- | :----------------------------------------------------------- |
| `io.openshift.tags`                                | æ­¤æ ‡ç­¾ - labelåŒ…å«ä»¥é€—å·åˆ†éš”å­—ç¬¦ä¸²å€¼åˆ—è¡¨è¡¨ç¤ºçš„æ ‡ç­¾ - tagåˆ—è¡¨ã€‚æ ‡ç­¾ - tagæ˜¯å°†å®¹å™¨é•œåƒåˆ†ç±»ä¸ºå¹¿æ³›åŠŸèƒ½åŒºåŸŸçš„æ–¹æ³•ã€‚æ ‡ç­¾å¸®åŠ©ç”¨æˆ·ç•Œé¢å’Œç”Ÿæˆå·¥å…·åœ¨åº”ç”¨ç¨‹åºåˆ›å»ºè¿‡ç¨‹ä¸­å»ºè®®ç›¸å…³çš„å®¹å™¨å›¾åƒã€‚`LABEL io.openshift.tags   mongodb,mongodb24,nosql` |
| `io.openshift.wants`                               | æŒ‡å®šç”Ÿæˆå·¥å…·å’Œç”¨æˆ·ç•Œé¢å¯èƒ½ç”¨äºæä¾›ç›¸å…³å»ºè®®çš„æ ‡ç­¾åˆ—è¡¨ï¼Œéœ€è¦å…·æœ‰ç»™å®šæ ‡è®°çš„å®¹å™¨é•œåƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®¹å™¨é•œåƒéœ€è¦mysqlå’Œredisï¼Œè€Œæ‚¨æ²¡æœ‰å¸¦æœ‰redisæ ‡ç­¾çš„å®¹å™¨é•œåƒï¼Œé‚£ä¹ˆUIå¯èƒ½å»ºè®®æ‚¨å°†æ­¤é•œåƒæ·»åŠ åˆ°éƒ¨ç½²ä¸­ã€‚`LABEL io.openshift.wants   mongodb,redis` |
| `io.k8s.description`                               | æ­¤æ ‡ç­¾å¯ç”¨äºå‘å®¹å™¨é•œåƒä½¿ç”¨è€…æä¾›æœ‰å…³æ­¤é•œåƒæä¾›çš„æœåŠ¡æˆ–åŠŸèƒ½çš„æ›´è¯¦ç»†ä¿¡æ¯ã€‚ç„¶åï¼ŒUIå¯ä»¥å°†æ­¤æè¿°ä¸å®¹å™¨é•œåƒåç§°ä¸€èµ·ä½¿ç”¨ï¼Œä»¥å‘æœ€ç»ˆç”¨æˆ·æä¾›æ›´äººæ€§åŒ–çš„ä¿¡æ¯ã€‚`LABEL io.k8s.description The MySQL 5.5 Server with master-slave replication support` |
| `io.openshift.non-scalable`                        | é•œåƒå¯èƒ½ä½¿ç”¨æ­¤å˜é‡æ¥è¡¨ç¤ºå®ƒä¸æ”¯æŒç¼©æ”¾ã€‚ç„¶åï¼Œç”¨æˆ·ç•Œé¢å°†æ­¤ä¿¡æ¯ä¼ è¾¾ç»™è¯¥å›¾åƒçš„æ¶ˆè´¹è€…ã€‚ä¸å¯ä¼¸ç¼©åŸºæœ¬ä¸Šæ„å‘³ç€å‰¯æœ¬çš„å€¼æœ€åˆä¸åº”è®¾ç½®ä¸ºå¤§äº1ã€‚`LABEL io.openshift.non-scalable     true` |
| `io.openshift.min-memory` å’Œ`io.openshift.min-cpu` | æ­¤æ ‡ç­¾å»ºè®®å®¹å™¨é•œåƒå¯èƒ½éœ€è¦å¤šå°‘èµ„æºæ‰èƒ½æ­£å¸¸å·¥ä½œã€‚ç”¨æˆ·ç•Œé¢å¯èƒ½ä¼šè­¦å‘Šç”¨æˆ·éƒ¨ç½²æ­¤å®¹å™¨æ˜ åƒå¯èƒ½ä¼šè¶…å‡ºå…¶ç”¨æˆ·é…é¢ã€‚è¿™äº›å€¼å¿…é¡»ä¸kubernetesæ•°é‡å…¼å®¹ã€‚`LABEL io.openshift.min-memory 8Gi`      ` LABEL io.openshift.min-cpu 4` |

â–³ OpenShift å®¹å™¨å¹³å°æ”¯æŒçš„å…ƒæ•°æ®

## å‚è€ƒé“¾æ¥

- OpenShift Container Platform Docs - [Creating images](https://docs.openshift.com/container-platform/latest/openshift_images/create-images.html)
- Docker documentation - [Best practices for writing Dockerfiles](https://docs.docker.com/articles/dockerfile_best-practices/)
- Project Atomic documentation - [Guidance for Container Image Authors](http://www.projectatomic.io/docs/docker-image-author-guidance/)
- [â€œDockerå’ŒPID 1 zombie reapingé—®é¢˜â€](http://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/)
- [â€œæ­å¼€initç³»ç»Ÿï¼ˆPID 1ï¼‰çš„ç¥ç§˜é¢çº±â€](https://felipec.wordpress.com/2013/11/04/init/)
- GITHUB - [sclorg/s2i-python-container](https://github.com/sclorg/s2i-python-container)
- Blog article - [Resource management in Docker](https://goldmann.pl/blog/2014/09/11/resource-management-in-docker)
- Docker documentation - [Runtime Metrics](https://docs.docker.com/engine/admin/runmetrics/)
- Blog article - [Memory inside Linux containers](http://fabiokung.com/2014/03/13/memory-inside-linux-containers)
- Docker documentation - [Docker basics](https://docs.docker.com/engine/docker-overview/)
- Docker documentation - [Dockerfile reference](https://docs.docker.com/engine/reference/builder/)
- Docker documentation - [è‡ªå®šä¹‰å…ƒæ•°æ®](https://docs.docker.com/engine/userguide/labels-custom-metadata)ã€‚
- testdriven.io - [Deploying Django to Heroku With Docker](https://testdriven.io/blog/deploying-django-to-heroku-with-docker/?utm_source=realpython)
- testdriven.io - [Dockerizing Django with Postgres, Gunicorn, and Nginx](https://testdriven.io/blog/dockerizing-django-with-postgres-gunicorn-and-nginx/)
- dockercon-2018 - [Docker for Python Developers](https://mherman.org/presentations/dockercon-2018/)
- Docker documentation - [å¤šé˜¶æ®µæ„å»º](https://docs.docker.com/develop/develop-images/multistage-build/)
- Red Hat Developer - [OpenJDK and Containers](https://developers.redhat.com/blog/2017/04/04/openjdk-and-containers/)
- [Java Application Optimization on Kubernetes on the Example of a Spring Boot Microservice](https://medium.com/faun/java-application-optimization-on-kubernetes-on-the-example-of-a-spring-boot-microservice-cf3737a2219c)
- Python Speed - [Faster Docker builds with pipenv, poetry, or pip-tools](https://pythonspeed.com/articles/pipenv-docker/)
- Python Speed - [Configuring Gunicorn for Docker](https://pythonspeed.com/articles/gunicorn-in-docker/)
- Docker documentation - [Docker and Eclipse](https://github.com/docker/labs/blob/master/developer-tools/java/chapters/ch07-eclipse.adoc#Docker_Eclipse)
- Docker documentation - [Docker and IntelliJ IDEA](https://github.com/docker/labs/blob/master/developer-tools/java/chapters/ch07-intellij.adoc#Docker_IntelliJ)
- [Developing inside a Container](https://code.visualstudio.com/docs/remote/containers)